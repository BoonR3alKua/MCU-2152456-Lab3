/*
 * button.c
 *
 *  Created on: Nov 12, 2023
 *      Author: MY GEAR
 */


#include "button.h"

int button_flag1 = 0;
int button_flag2 = 0;
int button_flag3 = 0;
int KeyReg[3][4] = {
		{NORMAL_STATE,NORMAL_STATE,NORMAL_STATE,NORMAL_STATE},
		{NORMAL_STATE,NORMAL_STATE,NORMAL_STATE,NORMAL_STATE},
		{NORMAL_STATE,NORMAL_STATE,NORMAL_STATE,NORMAL_STATE}
};
int TimerForKeyPress = 100;

int button_ports[3] = {BT1_GPIO_Port, BT2_GPIO_Port, BT3_GPIO_Port};
int button_pins[3] = {BT1_Pin, BT2_Pin, BT3_Pin};

int isButton1Pressed(int key){
	if(button_flag1 == 1){
		button_flag1 = 0;
		return 1;
	}
	return 0;
}
int isButton2Pressed(int key){
	if(button_flag2 == 1){
		button_flag2 = 0;
		return 1;
	}
	return 0;
}
int isButton3Pressed(int key){
	if(button_flag3 == 1){
		button_flag3 = 0;
		return 1;
	}
	return 0;
}
void subKeyProcess1(){
	button_flag1 = 1;
}
void subKeyProcess2(){
	button_flag2 = 1;
}
void subKeyProcess3(){
	button_flag3 = 1;
}
void getKeyInput(int key){
	KeyReg[key][0] = KeyReg[key][1];
	KeyReg[key][1] = KeyReg[key][2];
	KeyReg[key][2] = HAL_GPIO_ReadPin(button_ports[key - 1],button_pins[key - 1]);
	if((KeyReg[key][0] == KeyReg[key][1]) && (KeyReg[key][1] == KeyReg[key][2])){
		if(KeyReg[key][3] != KeyReg[key][2]){
			KeyReg[key][3] = KeyReg[key][2];
			if(KeyReg[key][2] == PRESSED_STATE){
				switch (key) {
					case 1:
						subKeyProcess1();
						break;
					case 2:
						subKeyProcess2();
						break;
					case 3:
						subKeyProcess3();
						break;
				}
				TimerForKeyPress = 100;
			}
		}else{
			TimerForKeyPress--;
			if(TimerForKeyPress == 0){
				KeyReg[key][3] = NORMAL_STATE;
			}
		}
	}
}
